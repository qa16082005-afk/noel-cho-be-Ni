<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Magic Camera</title>

<!-- THREE -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>

<!-- MEDIAPIPE -->
<script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js"></script>

<style>
html,body{
  margin:0;
  padding:0;
  overflow:hidden;
  background:black;
  font-family:sans-serif;
}

/* CAMERA FULL BACKGROUND */
.input_video{
  position:fixed;
  top:0;
  left:0;
  width:100vw;
  height:100vh;
  object-fit:cover;
  z-index:0;
  transform:scaleX(-1);
}

/* THREE CANVAS */
#canvas-container{
  position:fixed;
  top:0;left:0;
  width:100vw;
  height:100vh;
  z-index:1;
  pointer-events:none;
}

/* UI */
#ui-layer{
  position:fixed;
  bottom:30px;
  width:100%;
  text-align:center;
  z-index:3;
  color:white;
}
button{
  padding:14px 36px;
  border-radius:30px;
  border:2px solid gold;
  background:#b00000;
  color:white;
  font-weight:800;
  cursor:pointer;
}
</style>
</head>

<body>

<!-- CAMERA (CH·ªà 1 C√ÅI DUY NH·∫§T) -->
<video class="input_video" autoplay muted playsinline></video>

<!-- THREE -->
<div id="canvas-container"></div>

<!-- UI -->
<div id="ui-layer">
  üñê Open | ü´∂ Heart | ‚úä Fist<br><br>
  <button onclick="startSystem()">START MAGIC</button>
</div>

<script>
/* =======================
   THREE.JS ‚Äì ·∫¢NH BAY
======================= */
let scene,camera,renderer,photos=[];
const images=[
  "image1.jpeg",
  "image2.jpeg",
  "image3.jpeg",
  "image4.jpeg",
  "image5.jpeg"
];

function initThree(){
  scene=new THREE.Scene();
  camera=new THREE.PerspectiveCamera(60,innerWidth/innerHeight,1,1000);
  camera.position.z=120;

  renderer=new THREE.WebGLRenderer({alpha:true});
  renderer.setSize(innerWidth,innerHeight);
  document.getElementById("canvas-container").appendChild(renderer.domElement);

  const loader=new THREE.TextureLoader();
  images.forEach((src,i)=>{
    const mat=new THREE.SpriteMaterial({map:loader.load(src)});
    const sp=new THREE.Sprite(mat);
    sp.scale.set(20,20,1);
    sp.angle=i*1.2;
    scene.add(sp);
    photos.push(sp);
  });

  animate();
}

function animate(){
  requestAnimationFrame(animate);
  photos.forEach((p,i)=>{
    p.angle+=0.002;
    p.position.x=Math.cos(p.angle+i)*50;
    p.position.z=Math.sin(p.angle+i)*50;
  });
  renderer.render(scene,camera);
}

/* =======================
   MEDIAPIPE ‚Äì CAMERA FIX
======================= */
function startSystem(){
  initThree();

  const video=document.querySelector(".input_video");

  const hands=new Hands({
    locateFile:f=>`https://cdn.jsdelivr.net/npm/@mediapipe/hands/${f}`
  });

  hands.setOptions({
    maxNumHands:2,
    minDetectionConfidence:0.6,
    minTrackingConfidence:0.6
  });

  hands.onResults(()=>{});

  const cam=new Camera(video,{
    onFrame:async()=>{
      await hands.send({image:video});
    },
    width:1280,
    height:720
  });

  cam.start();
}

/* =======================
   RESIZE
======================= */
window.addEventListener("resize",()=>{
  camera.aspect=innerWidth/innerHeight;
  camera.updateProjectionMatrix();
  renderer.setSize(innerWidth,innerHeight);
});
</script>

</body>
</html>
